#!/bin/sh -e
APP=openssl
VERS=0.9.7d
BDIR=`pwd`
PREFIX=$BDIR/inst
PATH=/usr/ccs/bin:$SUNPROHOME/bin:/usr/bin:/usr/local/bin:/sbin
LD_LIBRARY_PATH=$PREFIX/lib
LD_RUN_PATH=$PREFIX/lib
CPPFLAGS="-I$PREFIX/include"
CC=gcc
CFLAGS="-O2"
LDFLAGS="-L$PREFIX/lib -R$PREFIX/lib"
EDITOR="vi"
export PATH LD_LIBRARY_PATH LD_RUN_PATH CC CFLAGS CPPFLAGS LDFLAGS EDITOR

/bin/rm -rf $APP-$VERS
gzip -dc $APP-$VERS.tar.gz | tar xvf -
cd $APP-$VERS
# Alter Configure script to put in our CFLAGS
cp -p ./Configure ./Configure.bak
diff ./Configure.bak ./Configure || /bin/true
perl ./Configure no-asm no-idea no-shared no-dso no-krb5 threads zlib-dynamic \
        --prefix=$PREFIX \
        linux-pentium
make all test install
chmod -R +x $PREFIX/lib/pkgconfig
/bin/rm -rf $PREFIX/ssl $PREFIX/lib/pkgconfig

# Make sure there are libtool config files for libssl and libcrypto
cat > $PREFIX/lib/libcrypto.la <<EOF1
# libcrypto.la - a libtool library file
# Generated by ltmain.sh - GNU libtool 1.4.2 (1.922.2.53 2001/09/11 03:18:52)
dlname=''
library_names=''
old_library='libcrypto.a'
dependency_libs=''
current=0
age=9
revision=7
dlopen=''
dlpreopen=''
libdir='$PREFIX/lib'
EOF1

cat > $PREFIX/lib/libssl.la <<EOF2
# libssl.la - a libtool library file
# Generated by ltmain.sh - GNU libtool 1.4.2 (1.922.2.53 2001/09/11 03:18:52)
dlname=''
library_names=''
old_library='libssl.a'
dependency_libs='$PREFIX/lib/libcrypto.la'
current=0
age=9
revision=7
installed=yes
dlopen=''
dlpreopen=''
libdir='$PREFIX/lib'
EOF2

chmod 755 $PREFIX/lib/libcrypto.la $PREFIX/lib/libssl.la
